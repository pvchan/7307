{% extends 'base.html' %}
{% block title %} Search {% endblock title %}
{% load cart %}
{% load custom_filter %}

{% block content %}
<div class="container-fluid mt-3">
    <div class="row">

        <!-- main content -->
        <div class="col-lg-9 mx-auto">
            <h1>Search</h1>

            <form onsubmit="performSearch(); return false;">
                <input type="text" id="searchQuery" placeholder="Enter your search term..." class="form-control mb-2">
                <input type="button" value="Search" onclick="performSearch()" class="btn btn-primary">
            </form>

            <div id="results" class="mt-4 mb-4">Results will appear here</div>

            <div class="row mx-auto" id="productList">
                {% for product in products %}
                <div class="card mx-auto mb-3 product-card" id={{product.id}} data-product-name="{{product.name}}" style="width: 18rem;">
                    <img class="card-img-top" src="{{product.image.url}}" alt="Card image cap">
                    <div class="card-body">
                        <p class="card-title">{{product.name}}</p>
                        <p class="card-text"><b>{{product.price|currency}}</b></p>
                    </div>
                    <!-- ... (rest of your card layout) ... -->
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    function performSearch() {
    var searchTerm = document.getElementById('searchQuery').value;
    window.location.hash = encodeURIComponent(searchTerm);
    filterProducts(searchTerm);
}

function filterProducts(term) {
    var cards = document.querySelectorAll('.product-card');
    var resultsCount = 0;

    cards.forEach(function(card) {
        var productName = card.getAttribute('data-product-name');

        if (productName.toLowerCase().includes(term.toLowerCase())) {
            card.style.display = 'block';
            resultsCount++;
        } else {
            card.style.display = 'none';
        }
    });

    var resultsDiv = document.getElementById('results');
    if (resultsCount > 0) {
        resultsDiv.innerHTML = "You searched for: " + term;
    } else {
        resultsDiv.innerHTML = "No results found for: " + term;
    }
}

window.onload = function() {
    var hashTerm = decodeURIComponent(window.location.hash.substring(1));
    if (hashTerm) {
        document.getElementById('searchQuery').value = hashTerm;
        filterProducts(hashTerm);
    }
};

</script>

{% endblock %}
